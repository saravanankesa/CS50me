{% extends 'monemome/layout.html' %}

{% block content %}
<div class="container">
    <div class="sub-header">
        <div class="btn-group" role="group" aria-label="Transaction navigation">
            <a href="{% url 'list_transactions' %}" class="btn btn-secondary">List Transactions</a>
            <a href="{% url 'add_transaction' %}" class="btn btn-secondary">Add Transaction</a>
            <a href="{% url 'pre_auth_payments' %}" class="btn btn-secondary">Pre-Auth Payments</a>
            <a href="{% url 'recurring_incomes' %}" class="btn btn-secondary">Recurring Incomes</a>
        </div>
    </div>
    <p></p>
    <!-- Sorting form -->
    <form method="get" class="sorting-form mb-3">
        <div class="row align-items-end">
            <div class="col-auto">
                <label for="sort" class="form-label">Sort by:</label>
                <select name="sort" id="sort" class="form-select">
                    <option value="date">Date</option>
                    <option value="account">Account</option>
                    <option value="category">Category</option>
                    <option value="transaction_type">Transaction Type</option>
                </select>
            </div>
            <div class="col-auto">
                <label for="order" class="form-label">Order:</label>
                <select name="order" id="order" class="form-select">
                    <option value="desc">Descending</option>
                    <option value="asc">Ascending</option>
                </select>
            </div>
        </div>
    </form>
    <p></p>
    <!-- Transaction listing view -->
    <h2>Transactions</h2>
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-danger" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    <div id="transaction-list">
        {% include 'monemome/partials/transaction_table.html' %}
    </div>
</div>   
<script>
document.addEventListener('DOMContentLoaded', function() {
    const sortSelect = document.getElementById('sort');
    const orderSelect = document.getElementById('order');

    // Function to update transactions based on the selected sort and order
    function updateTransactions() {
        const sort = sortSelect.value;
        const order = orderSelect.value;

        fetch(`/transactions/list/?sort=${sort}&order=${order}`, {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.text())
        .then(html => {
            document.getElementById('transaction-list').innerHTML = html;
        })
        .catch(error => console.error('Error loading the transactions:', error));
    }

    // Attach event listeners to sort and order select elements
    sortSelect.addEventListener('change', function(event) {
        event.preventDefault(); // Prevent form submission
        updateTransactions();
    });

    orderSelect.addEventListener('change', function(event) {
        event.preventDefault(); // Prevent form submission
        updateTransactions();
    });
});

</script>
{% endblock %}
