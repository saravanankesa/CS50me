{% extends "network/layout.html" %}


{% block body %}
    <h1>{{ profile_user.username }}'s Profile</h1>
    <p>{{ followers }} followers</p>
    <p>{{ following }} following</p>

    {% if user.is_authenticated and user != profile_user %}
    <button id="follow-btn" class="btn btn-primary">
        {% if is_following %}
            Unfollow
        {% else %}
            Follow
        {% endif %}
    </button>
{% endif %}

    <!-- Display posts -->
    <div class="container">
        {% for post in posts %}
            <div class="post">
                <p>{{ post.content }}</p>
                <small>Posted on {{ post.timestamp }}</small>
            </div>
        {% endfor %}
    </div>

    <!-- Pagination controls -->
    <div class="pagination">
        {% if posts.has_previous %}
            <a href="?page=1">&laquo; First</a>
            <a href="?page={{ posts.previous_page_number }}">Previous</a>
        {% endif %}

        {% if posts.has_next %}
            <a href="?page={{ posts.next_page_number }}">Next</a>
            <a href="?page={{ posts.paginator.num_pages }}">Last &raquo;</a>
        {% endif %}
    </div>


    <script>
        document.getElementById("follow-btn").addEventListener("click", function() {
            fetch("{% url 'follow' username=profile_user.username %}", {
                method: "POST",
                headers: {
                    'X-CSRFToken': csrftoken  // Include the CSRF token in the request headers
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    location.reload();
                }
            });
        });
    </script>

{% endblock %}
